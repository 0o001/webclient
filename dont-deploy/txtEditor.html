<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>MEGA 2.0</title>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <link rel="stylesheet" type="text/css" href="../css/style.css" />
    <link rel="stylesheet" type="text/css" href="../css/fonts.css" />
    <link rel="stylesheet" type="text/css" href="../css/dialogs.css" />
    <link rel="stylesheet" type="text/css" href="../css/buttons.css" />
    <link rel="stylesheet" type="text/css" href="../css/toast.css" />
    <link rel="stylesheet" type="text/css" href="../css/dropdowns.css" />
    <link rel="stylesheet" type="text/css" href="../css/settings.css" />
    <link rel="stylesheet" type="text/css" href="../css/txteditor.css" />
    <link rel="stylesheet" type="text/css" href="../css/top-menu.css" />

    <link rel="stylesheet" type="text/css" href="../css/codemirror.css" />
    <script src="../js/vendor/codemirror.js"></script>
    <script src="../js/vendor/simplescrollbars.js"></script>

    <script type="text/javascript" src="../js/vendor/jquery.js"></script>
    <script type="text/javascript" src="../js/vendor/jquery.jscrollpane.js"></script>
    <!--<script type="text/javascript" src="../js/jquery.mousewheel.js"></script>
    <script type="text/javascript" src="../js/jquery.tokeninput.js"></script>-->
    <script type="text/javascript">

    </script>
</head>

<body id="body-txt-editor" style="background-color: initial !important;">
    <div id="mega-text-editor">
        
        <div class="editor-textarea-container">
            <div class="editor-btn-container">
                <div class="txt-editor-menu">
                </div>
                <div class="top-menu-popup ">
                    <div class="top-menu-content">
                        <div class="top-menu-item new-f">New</div>
                        <div class="top-menu-item open-f">Open...</div>
                        <div class="top-menu-divider">
                            <div class="txt-editor-sp-menu"></div>
                        </div>

                        <div class="top-menu-item get-link-f">Get Link...</div>
                        <div class="top-menu-item send-contact-f"><span class="right-el"><i class="semi-small-icon yellow-triangle"></i></span><span>Send to Contacts...</span></div>
                        <div class="top-menu-divider">
                            <div class="txt-editor-sp-menu"></div>
                        </div>

                        <div class="top-menu-item close-f">Close</div>
                        <div class="top-menu-item save-f ">Save</div>
                        <div class="top-menu-item save-as-f">Save as...</div>
                        <div class="top-menu-divider">
                            <div class="txt-editor-sp-menu"></div>
                        </div>

                        <div class="top-menu-item save-f">Print...</div>
                    </div>
                </div>
                <div class="editor-file-name-title">
                    <span class="transfer-filetype-icon text file"></span>
                    <span class="txt-editor-opened-f-name" >fdkjghfdkjlhnj5894ngdfkjgngfikmdgfdognmdfoingeoirnteso845.txt</span>
                </div>
                <div class="buttons-holder">
                    <div class="default-white-button gradient txt-editor-btn close-btn">
                        <span>Close</span>
                    </div>
                    <div class="default-green-button gradient txt-editor-btn save-btn disabled">
                        <span>Save</span>
                    </div>
                </div>
            </div>
            <textarea id="txtar"></textarea>
        </div>
    </div>
    <script>
        var myTextarea = $('#txtar');
        var iFramecontainer;
        var setFunction;
        var remFunction;
        var fileHandle;
        var versionHandle;

        var editor = CodeMirror.fromTextArea(myTextarea[0], {
            lineNumbers: true,
            scrollbarStyle: "overlay"
        });
        $('.txt-editor-menu').off('click').on('click',
            function textEditorMenuOpen() {
                $('.top-menu-popup').show();
                return false;
            });


        $('#mega-text-editor').off('click').on('click',
            function textEditorGlobalClick() {
                $('.top-menu-popup').hide();
                return false;
            });


        $('#mega-text-editor .top-menu-item, #mega-text-editor .top-menu-divider').off('click').on('click',
            function textEditorMenuItemSelect() {
                
                return false;
            });

        function setupEditor(fName, txt, container, setterFunction, handle, removeFunction) {
            // myTextarea.text(txt);
            $('#mega-text-editor .buttons-holder .save-btn').addClass('disabled');
            if (editor) {
                editor.setValue(txt);

                var changeListner = function() {
                    $('#mega-text-editor .buttons-holder .save-btn').removeClass('disabled');
                    editor.off('change', changeListner);
                };

                editor.on('change', changeListner);
            }

            $('#mega-text-editor .txt-editor-opened-f-name').text(fName);
            iFramecontainer = container;
            setFunction = setterFunction;
            remFunction = removeFunction;
            fileHandle = handle;
            versionHandle = '';
        }

        // remove for testing only
        //if (u_k) {
        //     console.error(u_k);
        //}
        //if (u_attr) {
        //    console.error(u_attr);
        //}
        // end of test


        $('#mega-text-editor .buttons-holder .close-btn').off('click').on('click',
            function textEditorCloseBtnClick() {
                editor && editor.setValue('');
                if (iFramecontainer) {
                    iFramecontainer.addClass('hidden');
                }
                return false;
            });

        $('#mega-text-editor .buttons-holder .save-btn').off('click').on('click',
            function textEditorSaveBtnClick() {
                if ($(this).hasClass('disabled')) {
                    return false;
                }
                if (setFunction && editor) {
                    setFunction(fileHandle, editor.getValue()).done(function(fh) {
                        if (versionHandle) {
                            remFunction(versionHandle);
                        }
                        versionHandle = fh;
                    });
                }
            });

        
    </script>
</body>
</html>











